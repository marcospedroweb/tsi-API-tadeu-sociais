(()=>{"use strict";function e(e,t){var n=document.querySelector("#main-alert");if(n&&e&&t){var a=n.querySelector("span");["alert-danger","alert-success","alert-warning"].forEach((function(e){return n.classList.remove(e)})),n.classList.add("alert-".concat(e)),a.textContent=t,n.classList.toggle("d-none"),setTimeout((function(){n.classList.toggle("show")}),200),setTimeout((function(){n.classList.toggle("show"),setTimeout((function(){n.classList.toggle("d-none")}),400)}),5e3)}}function t(){var e=JSON.parse(sessionStorage.getItem("userLogged")),t=document.querySelector("#unregistered-user"),n=document.querySelector("#create-post"),a=document.querySelector("#posts");if(e&&t){var o=document.querySelector("#div-login-register");if(!o.classList.contains("d-none")){o.classList.add("d-none");var s=document.querySelector("#div-user-logged");s.classList.contains("d-none")&&(s.querySelector("#user-name").textContent=e.name,s.classList.remove("d-none"))}t.classList.contains("d-none")||t.classList.toggle("d-none"),n.classList.contains("d-none")&&n.classList.toggle("d-none"),a.classList.contains("d-none")&&a.classList.toggle("d-none")}else if(t){var r=document.querySelector("#div-login-register");if(r.classList.contains("d-none")){r.classList.remove("d-none");var i=document.querySelector("#div-user-logged");i.classList.contains("d-none")||i.classList.add("d-none")}t.classList.contains("d-none")&&t.classList.toggle("d-none"),n.classList.contains("d-none")||n.classList.toggle("d-none"),a.classList.contains("d-none")||a.classList.toggle("d-none")}}function n(){if(localStorage.getItem("users"))if(localStorage.getItem("posts")){var e=JSON.parse(window.localStorage.getItem("users")),t=JSON.parse(window.localStorage.getItem("posts"));e.length>0&&(e.forEach((function(e,t){e.id=t})),localStorage.setItem("users",JSON.stringify(e))),t.length>0&&(t.forEach((function(e,t){e.id=t})),localStorage.setItem("posts",JSON.stringify(t)))}else localStorage.setItem("posts",JSON.stringify([]));else localStorage.setItem("users",JSON.stringify([]))}function a(){var t=document.querySelectorAll(".button-delete-post");t[0]&&t.forEach((function(t){t.addEventListener("click",(function(t){var a=t.target.getAttribute("id").replace("button-delete-",""),o=JSON.parse(sessionStorage.getItem("userLogged")),r=JSON.parse(window.localStorage.getItem("posts"));r.forEach((function(t,n){t.id==parseInt(a)&&t.userId==o.id&&(r.splice(n,1),e("success","Postagem apagada com sucesso"))})),localStorage.setItem("posts",JSON.stringify(r)),n(),s()}))}))}function o(){var e=document.querySelectorAll(".post-time");e[0]&&e.forEach((function(e){if("false"==e.dataset.formated){var t=function(e){var t=36e5,n=24*t,a=7*n,o=4*a,s=12*o;if((e=(new Date).getTime()-e)<1e3)return"".concat(e," milesimos atrás");if(e<6e4){var r=parseInt(e/1e3);return"".concat(r,1===r?" segundo atrás":" segundos atrás")}if(e<t){var i=parseInt(e/6e4);return"".concat(i,1===i?" minuto atrás":" minutos atrás")}if(e<n){var c=parseInt(e/t);return"".concat(c,1===c?" hora atrás":" horas atrás")}if(e<a){var l=parseInt(e/n);return"".concat(l,1===l?" dia atrás":" dias atrás")}if(e<o){var d=parseInt(e/a);return"".concat(d,1===d?" semana atrás":" semanas atrás")}if(e<s){var u=parseInt(e/o);return"".concat(u,1===u?" mês atrás":" mêses atrás")}var m=parseInt(e/s);return"".concat(m,1===m?" ano atrás":" anos atrás")}(e.textContent);e.textContent=t,e.dataset.formated=!0}}))}function s(){var e=document.querySelector("#posts");if(e){var t=JSON.parse(window.localStorage.getItem("posts")).reverse();e.querySelectorAll(".post").forEach((function(t){e.removeChild(t)})),t.forEach((function(t){var n=function(e){var t=JSON.parse(sessionStorage.getItem("userLogged")),n=document.createElement("article");n.classList.add("post","col-10","col-md-6","d-flex","flex-column","py-4","p-2","rounded");var a=document.createElement("div"),o=document.createElement("i"),s=document.createElement("h3"),r=document.createElement("h3"),i=document.createElement("button");a.classList.add("d-flex","align-items-center","post-header","position-relative"),o.classList.add("bi","bi-person-circle","me-2"),s.classList.add("post-username","mb-0","me-2","h3"),s.textContent=e.username,r.classList.add("post-time"),r.textContent=e.date,r.dataset.formated=!1,t.id==e.userId&&(i.classList.add("button-delete-post","btn","btn-secondary","position-absolute","top-50","end-0","translate-middle-y"),i.setAttribute("id","button-delete-".concat(e.id)),i.setAttribute("type","button"),i.textContent="Apagar postagem"),a.appendChild(o),a.appendChild(s),a.appendChild(r),t.id==e.userId&&a.appendChild(i);var c=document.createElement("div");if(e.text){var l=document.createElement("div"),d=document.createElement("div"),u=document.createElement("p");l.classList.add("bg-post-text","position-relative","p-2","my-2","rounded"),d.classList.add("block-decorator"),u.classList.add("text-start","text-white","m-0"),u.textContent=e.textValue,l.appendChild(d),l.appendChild(u),c.appendChild(l)}if(e.media){var m=document.createElement("div");if(".mp4"==e.mediaType){var g=document.createElement("video");g.classList.add("ratio","ratio-16x9"),g.setAttribute("controls","controls"),g.setAttribute("preload","none"),g.src=e.mediaSrc,m.appendChild(g)}else if("mpeg"==e.mediaType){var p=document.createElement("audio");p.setAttribute("controls","controls"),p.setAttribute("preload","none"),p.src=e.mediaType,m.appendChild(p)}else{var v=document.createElement("img");v.classList.add("img-fluid"),v.src=e.mediaSrc,m.appendChild(v)}c.appendChild(m)}if(e.draw){var f=document.createElement("div"),h=document.createElement("img");f.classList.add("p-2"),h.classList.add("img-fluid"),h.src=e.drawSrc,f.appendChild(h),c.appendChild(f)}if(e.location){var S=document.createElement("div"),L=document.createElement("iframe");L.src=e.locationSrc,L.classList.add("ratio","ratio-1x1"),window.innerWidth<992?L.setAttribute("height",400):L.setAttribute("height",500),S.appendChild(L),c.appendChild(S)}return n.appendChild(a),n.appendChild(c),n}(t);e.appendChild(n)})),a(),o()}}function r(t){if(t){var n=JSON.parse(window.localStorage.getItem("posts"));n.push(t)?(localStorage.setItem("posts",JSON.stringify(n)),e("success","Postagem realizado com sucesso!"),s()):e("danger","Houve um erro ao realizar a postagem, tente novamente")}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var c,l,d,u,m,g,p,v,f,h,S,L,y,w,q,b,E;n(),function(){for(var t=window.location.search.substr(1).split("&"),n={},a=0;a<t.length;a++){var o=t[a].split("=");n[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}n.success&&"account-created"==n.success&&(e("success","Conta criada com sucesso!"),location.href=location.href.replace("?success=account-created",""))}(),e(),c=document.querySelectorAll(".needs-validation"),Array.prototype.slice.call(c).forEach((function(e){e.addEventListener("submit",(function(t){e.checkValidity()||(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")}),!1)})),l=document.querySelector("#unregistered-user"),d=document.querySelector("#create-post"),u=document.querySelector("#posts"),m=JSON.parse(sessionStorage.getItem("userLogged")),l&&m&&(l.classList.contains("d-none")||l.classList.toggle("d-none"),d.classList.contains("d-none")&&d.classList.toggle("d-none"),u.classList.contains("d-none")&&u.classList.toggle("d-none")),(g=document.querySelectorAll('[data-bs-toggle="tooltip"]'))[0]&&(E=g,function(e){if(Array.isArray(e))return i(e)}(E)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(E)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(E)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){return new bootstrap.Tooltip(e)})),p=document.querySelector("#form-register"),JSON.parse(sessionStorage.getItem("userLogged"))&&window.location.href.indexOf("register.html")&&p&&(window.location.href=window.location.href.replace("register.html","index.html")),p&&p.addEventListener("submit",(function(t){t.preventDefault();var n=JSON.parse(localStorage.getItem("users")),a=p.querySelector("#name").value,o=p.querySelector("#email").value,s=p.querySelector("#password").value,r=p.querySelector("#confirm-password").value,i=p.querySelector("#cpf").value,c=p.querySelector("#tel").value,l=!1,d=!1;if(0!=o.length&&-1!=o.indexOf("@"))if(n.forEach((function(e){e.email==o&&(l=!0)})),l)e("danger","Este email está indisponível, utilize outro");else if(s.toLowerCase()!==s)if(s.length<4)e("danger","A senha deve ter mínimo 4 caracteres");else if(s===r)if(n.forEach((function(e){e.cpf==i&&(d=!0)})),d)e("danger","Este CPF já esta sendo utilizando, tente outro.");else if(i.match(/\d{3}\.?\d{3}\.?\d{3}-?\d{2}/g))if(c.length>1&&!c.match(/\(?\d{2}\)?\ ?\d{5}\-?\d{4}/g))e("danger","O número de celular deve ser maior que 11 caracteres. Ex: (99) 99999-9999");else{var u={id:0,name:a,email:o,password:s,cpf:i,tel:c||"Não registrado"};n.push(u),localStorage.setItem("users",JSON.stringify(n)),window.location.href=window.location.href.replace("register.html","login.html?success=account-created")}else e("danger","O CPF deve ser maior que 11 caracteres. Ex: xxx.xxx.xxx-xx");else e("danger","As senhas não são iguais!");else e("danger","A senha deve possuir ao menos 1 letra maiúscula");else e("danger","Insira um email valido. Ex: exemploEmail@email.com")})),v=document.querySelector("#form-login"),JSON.parse(sessionStorage.getItem("userLogged"))&&window.location.href.indexOf("login.html")&&v&&(window.location.href=window.location.href.replace("login.html","index.html")),v&&v.addEventListener("submit",(function(t){t.preventDefault();var n,a=JSON.parse(window.localStorage.getItem("users")),o=v.querySelector("#email").value,s=v.querySelector("#password").value;a.forEach((function(e){e.email===o&&e.password===s&&(n=e)})),n?(sessionStorage.setItem("userLogged",JSON.stringify(n)),window.location.href=window.location.href.replace("register.html","index.html")):(e("danger","Senha e/ou email não correspondem."),v.querySelector("#password").value="")})),t(),(f=document.querySelector("#link-logout"))&&f.addEventListener("click",(function(n){n.preventDefault(),JSON.parse(sessionStorage.getItem("userLogged"))&&(sessionStorage.removeItem("userLogged"),t(),e("success","Saiu da sessão com sucesso"))})),(h=document.querySelector("#cpf"))&&(h.addEventListener("input",(function(e){"insertFromPaste"==e.inputType&&(h.value="")})),h.addEventListener("keypress",(function(e){[3,7].includes(h.value.length)&&"."!=e.key?h.value+=".":11==h.value.length&&"-"!=e.key?h.value+="-":(h.value.length>10&&h.value.match(/\d{3}\.?\d{3}\.?\d{3}-?\d{2}/g)||isNaN(e.key)&&"."!=e.key&&"-"!=e.key)&&e.preventDefault()}))),(S=document.querySelector("#tel"))&&(S.addEventListener("input",(function(e){"insertFromPaste"==e.inputType&&(S.value="")})),S.addEventListener("keypress",(function(e){0==S.value.length&&"("!==e.key?S.value+="(":3==S.value.length&&")"!==e.key?S.value+=") ":4==S.value.length&&" "!==e.key?S.value+=" ":10==S.value.length&&"-"!==e.key?S.value+="-":(S.value.length>0&&S.value.match(/\(?\d{2}\)?\ ?\d{5}\-?\d{4}/g)||isNaN(e.key)&&"-"!==e.key&&"("!==e.key&&")"!==e.key)&&e.preventDefault()}))),function(){var t=document.querySelector("#btn-add-location"),n=document.querySelector("#data-location"),a=document.querySelector("#span-location");if(t)if("geolocation"in navigator){var o=function(e){var o=e.coords.latitude,s=e.coords.longitude;n.value="https://embed.waze.com/pt-BR/iframe?zoom=12&lat=".concat(o,"&lon=").concat(s,"&pin=1"),t.classList.contains("disabled")||t.classList.toggle("disabled"),a.classList.contains("d-none")&&a.classList.toggle("d-none"),setTimeout((function(){a.classList.contains("show")||a.classList.toggle("show")}),250)},s=function(t){e("danger","Houve um erro! Não é possivel adicionar a localização atual, tente novamente.")},r={enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4};t.addEventListener("click",(function(e){navigator.geolocation.getCurrentPosition(o,s,r)}))}else e("danger","Ops, seu navegador não suporta geolocation")}(),function(){var t=document.querySelector("#drawingBoard");if(t){var n=function(){p=i.value,v=c.value,f=l.value},a=function(e){if(e.preventDefault(),"false"!==r.drawing){var n=function(e,t){var n,a;t.preventDefault();var o=e.getBoundingClientRect();return t.changedTouches?(n=t.changedTouches[0].clientX-o.left,a=t.changedTouches[0].clientY-o.top):(n=t.clientX-o.left,a=t.clientY-o.top),{x:n,y:a}}(t,e);s.lineWidth=p,s.lineCap=v,s.strokeStyle=f,s.lineTo(n.x,n.y),s.stroke(),s.beginPath(),s.moveTo(n.x,n.y)}},o=document.querySelector("#btn-add-draw"),s=t.getContext("2d"),r=t.dataset,i=document.querySelector("#option-line-width"),c=document.querySelector("#option-line-cap"),l=document.querySelector("#option-line-color"),d=document.querySelector("#clear-drawing"),u=document.querySelector("#save-draw"),m=document.querySelector("#span-draw"),g=document.querySelector("#data-draw"),p=i.value,v=c.value,f=l.value;i.addEventListener("input",(function(e){i.value.length&&0!=i.value||(i.value=5),n()})),c.addEventListener("change",(function(e){e.preventDefault(),n()})),l.addEventListener("change",(function(e){e.preventDefault(),n()})),t.addEventListener("mousedown",(function(e){e.preventDefault(),r.drawing=!0,a(e)})),t.addEventListener("touchstart",(function(e){e.preventDefault(),r.drawing=!0,a(e)})),t.addEventListener("mouseup",(function(e){e.preventDefault(),r.drawing=!1,s.beginPath()})),t.addEventListener("touchend",(function(e){e.preventDefault(),r.drawing=!1,s.beginPath()})),t.addEventListener("mousemove",a),t.addEventListener("touchmove",a),o.addEventListener("click",(function(){window.innerWidth>992&&(t.width=600,t.height=600)})),o.addEventListener("touchstart",(function(){window.innerWidth<992&&(t.width=300,t.height=300)})),d.addEventListener("click",(function(e){e.preventDefault(),s.clearRect(0,0,t.width,t.height)})),u.addEventListener("click",(function(){var n=t.toDataURL("image/png",1);n.length>5e5?e("danger","O tamanho do arquivo é maior que 500KB, tente novamente"):(g.value=n,o.classList.contains("disabled")||o.classList.toggle("disabled"),m.classList.contains("d-none")&&m.classList.toggle("d-none"),setTimeout((function(){m.classList.contains("show")||m.classList.toggle("show")}),250))}))}}(),r(),s(),o(),L=document.querySelector("#post-content-text"),y=document.querySelector("#char-counter span"),L&&L.addEventListener("input",(function(e){var t=e.target.value;y.textContent=t.length})),w=document.querySelectorAll(".post-content"),(q=document.querySelectorAll(".btn-cancel-content"))[0]&&q.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.getAttribute("id").replace("cancel-",""),n=document.querySelector("#btn-add-".concat(t));document.querySelector("#data-".concat(t)).value="",n.classList.contains("disabled")&&n.classList.toggle("disabled"),w.forEach((function(e){e.getAttribute("id").replace("span-","")==t&&(e.classList.contains("show")&&e.classList.toggle("show"),setTimeout((function(){e.classList.contains("d-none")||e.classList.toggle("d-none")}),250))}))}))})),function(){var t=document.querySelector("#btn-add-media"),n=document.querySelector("#midia-file"),a=document.querySelector("#span-media"),o=document.querySelector("#media-type"),s=document.querySelector("#data-media");n&&n.addEventListener("change",(function(r){var i=r.target.files[0],c=".".concat(i.type.replace("video/","").replace("image/","").replace("mpeg/","")),l=new FileReader;l.onload=function(r){i.size<=5e5&&[".mpeg",".mp4",".png",".jpg",".jpeg"].includes(c)?(s.value=r.target.result,o.textContent=c,a.classList.contains("d-none")&&a.classList.toggle("d-none"),t.classList.contains("disabled")||t.classList.toggle("disabled"),setTimeout((function(){a.classList.contains("show")||a.classList.toggle("show")}),250)):(n.value="",e("danger","O tamanho do arquivo deve ter no maximo 500KB e deve ser do tipo (.mp3, .mp4, .png ou .jpg)"))},l.readAsDataURL(r.target.files[0])}))}(),(b=document.querySelector("#btn-tadeuzar"))&&b.addEventListener("click",(function(){var t,n,a,o,s,i,c=JSON.parse(sessionStorage.getItem("userLogged")),l=JSON.parse(window.localStorage.getItem("posts")),d=document.querySelector("#post-content-text"),u=document.querySelector("#data-media"),m=document.querySelector("#media-type"),g=document.querySelector("#data-draw"),p=document.querySelector("#data-location"),v={id:l.length,userId:c.id,username:c.name,date:(new Date).getTime()};0!=d.value.trim().length||0!=u.value.length||0!=g.value.length||0!=p.value.length?(0!=d.value.trim()&&(v.text=!0,v.textValue=d.value),u.value&&(v.media=!0,v.mediaType=m.textContent,v.mediaSrc=u.value),g.value&&(v.draw=!0,v.drawSrc=g.value),p.value&&(v.location=!0,v.locationSrc=p.value),r(v),t=document.querySelector("#btn-add-location"),n=document.querySelector("#span-location"),a=document.querySelector("#btn-add-draw"),o=document.querySelector("#span-draw"),s=document.querySelector("#btn-add-media"),i=document.querySelector("#span-media"),d.value="",u.value="",m.textContent="",g.value="",p.value="",t.classList.contains("disabled")&&t.classList.toggle("disabled"),n.classList.contains("show")&&n.classList.toggle("show"),a.classList.contains("disabled")&&a.classList.toggle("disabled"),o.classList.contains("show")&&o.classList.toggle("show"),s.classList.contains("disabled")&&s.classList.toggle("disabled"),i.classList.contains("show")&&i.classList.toggle("show"),setTimeout((function(){n.classList.contains("d-none")||n.classList.toggle("d-none"),o.classList.contains("d-none")||o.classList.toggle("d-none"),i.classList.contains("d-none")||i.classList.toggle("d-none")}),250)):e("danger","Para realizar o post é necessário adicionar algum conteudo")})),a()})();